# Restart 3

* `useEffect`를 사용하여 마운트/언마운트/업데이트 시 할 작업 설정하기
    ```js
    function User({user, onRemove, onToggle}) {
        useEffect(() => { // 마운트
            console.log('컴포넌트가 화면에 나타남');
            return () => { // cleanup (deps가 비어있는 경우에는 컴포넌트가 사라질 때를 의미한다)
                console.log('컴포넌트가 화면에서 사라짐');
            };
        }, []); // []는 deps

        ...
    }
    ```
    * 첫 번째 파라미터에는 함수, 두 번째 파라미터에는 의존값이 들어있는 배열 `deps`를 넣는다. `deps` 배열을 비우게 되면 컴포넌트가 처음 나타날때만 `useEffect`에 등록한 함수가 호출된다.
    * `useEffect`에서 함수를 반환 할 수도 있으며, `cleanup` 함수라 부른다.
    * 주로 마운트 시에 하는 작업들은 다음과 같다.
        * `props`로 받은 값을 컴포넌트의 로컬 상태로 설정할 떄 사용한다.
        * 외부 API의 요청을 한다. (REST API 등)
        * 라이브러리를 사용한다. (D3, Video.js 등)
        * setInterval을 통한 반복작업 혹은 setTimeout을 통한 작업 예약의 경우 사용한다.
    * 언마운트 시에 하는 작업들은 다음과 같다.
        * setInterval, setTimeout을 사용하여 등록한 작업들을 Clear할 때 사용한다.
        * 라이브러리 인스턴스를 제거할때 사용한다.
    * `deps`에 특정 값을 넣게 된다면 컴포넌트가 처음 마운트 될 때에도 호출이 되고, 지정한 값이 바뀔 때에도 호출이 된다. 그리고 `deps` 안에 특정 값이 있다면 언마운트시에도 호출이되고, 값이 바뀌기 직전에도 호출이 된다.
        > `useEffect` 안에서 사용하는 `state`나 `props`가 있을 때 `deps`에 넣어주지 않는다면 등록한 함수가 실행될 때 최신 `props/state`를 가르키지 않게 된다.
    * `deps` 파라미터를 생략한다면, 컴포넌트가 리렌더링 될 때마다 호출이 된다.

> 리액트 컴포넌트는 기본적으로 **부모 컴포넌트가 리렌더링되면 자식 컴포넌트 또한 리렌더링이 된다.** 실제 DOM에 반영되는 것은 바뀐 내용이 있는 컴포넌트에만 해당이 되나 Virtual DOM에는 모두 렌더링한다. 이후 컴포넌트를 최적화 하는 과정에서 렌더링 하는 리소스를 아낄 수 있는 방법이 존재한다.

* 간단요약 : `useEffect`의 첫 마운트 되는 부분이후 `return` 되는 명령 함수가 `cleanup`이며, `deps` 배열에 있는 값이 변하였는지를 체크하고 변했다면 실행시킨다. `deps` 배열에 값이 없다면 첫 마운트 되는 부분만 실행시킨다. 반면, `deps` 파라미터가 없을 경우, 컴포넌트가 리렌더링 될 때마다 호출된다.
---

[참고사이트](https://www.rinae.dev/posts/a-complete-guide-to-useeffect-ko)